<!DOCTYPE HTML>
<html id="top" lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
		<meta name="theme-color" content="#142334">
		<title>cleanerr - Housekeeping! </title>
		<link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" type="text/css">
		<!-- Copyright (c) 2021 shi Blank
			 Licensed under the MIT license whose full text can be found at http://opensource.org/licenses/MIT -->
		<style>
			/*! minireset.css v0.0.3 | MIT License | github.com/jgthms/minireset.css */html,body,p,ol,ul,li,dl,dt,dd,blockquote,figure,fieldset,legend,textarea,pre,iframe,hr,h1,h2,h3,h4,h5,h6{margin:0;padding:0}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal}ul{list-style:none}button,input,select,textarea{margin:0}html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}img,embed,iframe,object,audio,video{height:auto;max-width:100%}iframe{border:0}table{border-collapse:collapse;border-spacing:0}td,th{padding:0;text-align:left}
			
			html	{scroll-behavior:smooth;}
			body, html	{-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; font-weight:normal; font-style:normal;}
			body	{background:#fff; font-family:sans-serif; font-size:12px; line-height:1.5em; color:#444;}
			body	{display:grid; height:100vh; grid-template-rows:auto 1fr auto;}
			h1		{font-size:4em; font-weight:normal; color:#1400ff;}
			h2		{font-size:2em; font-weight:normal;}
			h3		{font-size:1.3em; font-weight:bold;}
			a		{text-decoration:none;}
			p		{margin:1.5em 0;}
			img		{max-width:100%; height:auto;}
			.head_wrap	{padding:2em 0; margin:0 auto;}
			.foot_wrap	{max-width:1280px; padding:2em 4em; margin:0 auto;}
			.table_wrap	{max-width:1280px; padding:2em 4em 4em 4em; margin:0 auto;}
			table		{table-layout:fixed; overflow-wrap:break-word; word-wrap:break-word;}
			#table_errors th:nth-child(1)	{width:30%;}	/*	slug	*/
			#table_errors th:nth-child(3)	{width:40%;}	/*	url	*/
			#table_counts th:nth-child(2)	{width:20%;}	/*	type	*/
			#table_counts th:nth-child(3)	{width:10%;}	/*	num	*/
			#table_counts th:nth-child(4)	{width:40%;}	/*	url	*/
			.foot_wrap	{font-size:14px;}
			.foot_cont,
			.foot_cont_right	{box-sizing:border-box; display:inline-block; padding-right:1em; width:70%; vertical-align:top;}
			.foot_cont_right	{width:30%; padding-right:0;}
			.foot_cont_right .foot_text 	{font-size:12px;}
			.foot_cont_right .foot_text p	{margin:0.5em 0;}
			.foot_small	{font-size:12px;}
			.foot_bold	{font-weight:bold;}
						
			.dataTable-table > tbody > tr > td,
			.dataTable-table > tbody > tr > th,
			.dataTable-table > tfoot > tr > td,
			.dataTable-table > tfoot > tr > th,
			.dataTable-table > thead > tr > td,
			.dataTable-table > thead > tr > th	{padding:4px 10px; border-bottom:1px solid #eee;}
			
			/*	Back to top link	*/
			a.top		{display:block; width:100%; padding:20px 0; text-align:center; font-size:12px; color:#444; cursor:pointer;}
			a.top:hover	{background-color:#eee;}
			
			/*	PHONES & STUFF
				============================================= */
				
			@media only screen and (-webkit-min-device-pixel-ratio: 1.5),
			only screen and (-o-min-device-pixel-ratio: 3/2),
			only screen and (min--moz-device-pixel-ratio: 1.5),
			only screen and (min-device-pixel-ratio: 1.5) {

			.head_wrap	{padding:1em; margin:0 auto; line-height:2em;}
			.foot_wrap	{padding:2em; font-size:12px;}
			.table_wrap	{padding:1vh; max-width:initial;}
			#table_errors th,
			#table_counts th	{width:initial;}
			#table_counts th:nth-child(3)	{width:15%; padding:4px 0px 4px 10px;}	/*	num	*/
			
			.dataTable-top > nav:last-child,
			.dataTable-top > div:last-child,
			.dataTable-bottom > nav:last-child,
			.dataTable-bottom > div:last-child {float:none;}
			}
		</style>
		<script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" type="text/javascript"></script>	
		<script>
			/*	Modified for use. Thank you to Daniel Tillin - https://code.google.com/archive/p/csv-to-array/	*/
			csvToArray = function (str,o) {
				var od = {
					'fSep': ',',
					'rSep': '\n',
					'quot': '"',
					'head': false,
					'trim': false
				}
				if (o) {
					for (var i in od) {
						if (!o[i]) o[i] = od[i];
					}
				} else {
					o = od;
				}
				var a = [
					['']
				];
				for (var r = f = p = q = 0; p < str.length; p++) {
					switch (c = str.charAt(p)) {
					case o.quot:
						if (q && str.charAt(p + 1) == o.quot) {
							a[r][f] += o.quot;
							++p;
						} else {
							q ^= 1;
						}
						break;
					case o.fSep:
						if (!q) {
							if (o.trim) {
								a[r][f] = a[r][f].replace(/^\s\s*/, '').replace(/\s\s*$/, '');
							}
							a[r][++f] = '';
						} else {
							a[r][f] += c;
						}
						break;
					case o.rSep.charAt(0):
						if (!q && (!o.rSep.charAt(1) || (o.rSep.charAt(1) && o.rSep.charAt(1) == str.charAt(p + 1)))) {
							if (o.trim) {
								a[r][f] = a[r][f].replace(/^\s\s*/, '').replace(/\s\s*$/, '');
							}
							a[++r] = [''];
							a[r][f = 0] = '';
							if (o.rSep.charAt(1)) {
								++p;
							}
						} else {
							a[r][f] += c;
						}
						break;
					default:
						a[r][f] += c;
					}
				}
				if (o.head) {
					a.shift()
				}
				if (a[a.length - 1].length < a[0].length) {
					a.pop()
				}
				return a;
			}
		</script>
		<script>
			fetch("errors.csv")
			.then(response => response.text())
			.then(data => {
				
				let lines=csvToArray(data)
				
				console.log(lines)
				let header
				let datas=[]
				
				for (let line of lines)
				{					
					if (!header)
					{
						header=line
					}
					else
					{
						if (line.length!=1)
						{
							datas[datas.length]=line
							line[0]=`<a href="https://iatiregistry.org/dataset/${line[0]}">${line[0]}</a>`
							line[2]=`<a href="${line[2]}">${line[2]}</a>`
						}							
					}
				}
								
				let table = new simpleDatatables.DataTable("#table_errors", {
					data: {
					  headings: header,
					  data: datas
					},
					labels: {
						perPage: "{select} datasets per page",
						info: "Showing {start} to {end} of {rows} datasets",
					},
					perPageSelect: [15, 25, 50, 100],
					perPage: 15
				})
			})
		</script>		
		<script>
			fetch("counts.csv")
			.then(response => response.text())
			.then(data => {
				
				let lines=csvToArray(data)
				let header
				let datas=[]
				
				for (let line of lines)
				{
					if (line.length!=4)
					{
						console.log(line)
					}
					
					if (!header)
					{
						header=line
					}
					else
					{
						if (line.length!=1)
						{
							datas[datas.length]=line
							line[0]=`<a href="https://iatiregistry.org/dataset/${line[0]}">${line[0]}</a>`
							line[3]=`<a href="${line[3]}">${line[3]}</a>`
						}							
					}
				}
												
				let table = new simpleDatatables.DataTable("#table_counts", {
					data: {
					  headings: header,
					  data: datas
					},
					labels: {
						perPage: "{select} datasets per page",
						info: "Showing {start} to {end} of {rows} datasets",
					},
					perPageSelect: [15, 25, 50, 100],
					perPage: 15
				})
			})
		</script>
	</head>
	<body>
		<div class="table_wrap">
			<div class="head_wrap"><h2>Download and import errors</h2></div>
			<table id="table_errors"></table>
		</div>
		<div class="table_wrap">
			<div class="head_wrap"><h2>Activity or organisation count per dataset</h2></div>
			<table id="table_counts"></table>
		</div>
		<div class="wrap">
			<div class="foot_wrap">
				<div class="foot_cont">
					<div class="foot_bold"><p>About</p></div>
					<div class="foot_text">
						Cleaner converts the logs from <a href="https://github.com/xriss/dataiati">DataIATI</a> and displays them as tables.
					</div>
					<div class="foot_text">
						These logs are also available as csv files: [<a href="https://raw.githubusercontent.com/notshi/cleanerr/main/errors.csv">Download Errors</a>] [<a href="https://raw.githubusercontent.com/notshi/cleanerr/main/counts.csv">Download Counts</a>]
					</div>
					<div class="foot_text">
						Logs are updated daily. Last updated <span id="date"></span>
					</div>
					<script>
						let d = new Date().toUTCString()
						document.getElementById("date").innerHTML = d.toString();
					</script>
					<div class="foot_bold"><p><a href="http://github.com/notshi/cleanerr">Cleanerr is on Github</a></p></div>
					<div class="foot_small">Project by Wetgenes, 2021</div>
				</div><div class="foot_cont_right">
					<div class="foot_bold"><p>Other tools</p></div>
					<div class="foot_text"><a href="http://d-preview.codeforiati.org/">d-preview</a></div>
					<div class="foot_text"><p><a href="https://notshi.github.io/IATIswitcheroo/">IATI Switcheroo</a></p></div>
					<div class="foot_text"><a href="https://xriss.github.io/freechange-charts/">Freechange</a></div>
					<div class="foot_text"><p><a href="https://xriss.github.io/D-Portal-Logs/">d-portal logs</a></p></div>
				</div>
			</div>
			<a href="#top" class="top">BACK TOP</a>
		</div>
	</body>
</html>
